{% extends "base.html" %}
{% block title %}Main{% endblock %}

{% block content %}
    <div class="container mt-4 mb-md-5">
        <select name="countries" id="countries" multiple>
            <option selected value="Item">Item</option>
            <option selected value="Category">Category</option>
            <option selected value="Checkbox">Checkbox</option>
            <option value="Username">Username</option>
            <option value="Created_date">Created_date</option>
        </select>

        <form action="/add_item" class="mt-3" method="POST" id="add_item"></form>
        <div class="row">
            <div class="col-sm-12 table-responsive">
<!--                <script src="https://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>-->
                <script src="https://www.w3schools.com/lib/w3.js"></script>
                <table class="table table-dark sortable" id="main_table" >
                  <thead>
                    <tr>
                      <th onclick="w3.sortHTML('#main_table', '.item', 'td:nth-child(1)')" style="cursor:pointer" scope="col">#</th>
                      <th onclick="w3.sortHTML('#main_table', '.item', 'td:nth-child(2)')" style="cursor:pointer" class="td_name hide" scope="col">Item <i class="bi bi-caret-down-fill"></i></th>
                      <th onclick="w3.sortHTML('#main_table', '.item', 'td:nth-child(3)')" style="cursor:pointer" class="td_category hide" scope="col">Category <i class="bi bi-caret-down-fill"></i></th>
                      <th class="td_checkbox hide" scope="col"><i class="bi bi-check text-white"></i></th>
                      <th onclick="w3.sortHTML('#main_table', '.item', 'td:nth-child(5)')" style="cursor:pointer" class="td_username hide" scope="col">User <i class="bi bi-caret-down-fill"></i></th>
                      <th onclick="w3.sortHTML('#main_table', '.item', 'td:nth-child(6)')" style="cursor:pointer" class="td_created_date hide" scope="col">Date <i class="bi bi-caret-down-fill"></i></th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for shopping_list_item in shopping_list %}
                        <tr class="item">
                          <td scope="row">{{loop.index}}</td>
                          <td class="td_name hide"><a href="/item_details/{{shopping_list_item.id}}">{{ shopping_list_item.item }}</a></td>
                          <td class="td_category hide">{{ shopping_list_item.category }}</td>
                          <td class="td_checkbox hide">
                              <form action="/update_item_checkbox/{{shopping_list_item.id}}" method="POST" id="item_checkbox_update{{shopping_list_item.id}}">
                                  <div class="bootstrap-switch-square">
                                      <input onchange="document.getElementById('item_checkbox_update{{shopping_list_item.id}}').submit()" type="checkbox" name="checkbox_to_update" value="checked" id="checkbox" {{ "checked" if shopping_list_item.checked == True }} />
                                  </div>
                              </form>
                          </td>
                          <td class="td_username hide">{% set user_id = shopping_list_item.user_id %}
                              {% for user_data in users %}
                                {% if user_data.id == user_id %}
                                    {{user_data.first_name}}
                                {% endif %}
                              {% endfor %}
                          </td>
                          <td class="td_created_date hide">{{ shopping_list_item.created_date }}</td>
                        </tr>
                    {% endfor %}

                    <tr>
                      <th scope="row"></th>
                      <td class="td_name hide"><input class="w_30_p" type="text" name="item" form="add_item"></td>
                      {% if categories|length > 0 %}
                      <td class="td_category hide">
                          <input class="w_30_p" type="text" list="categories" name="category" form="add_item" autocomplete="off" value="Default" />
                            <datalist id="categories">
                              {% for category in categories %}
                                  <option value="{{category[0]}}">{{category[0]}}</option>
                              {% endfor %}
                            </datalist>
                      </td>
                      {% else %}
                        <td class="td_category hide"><input class="w_30_p" type="text" name="category" form="add_item" value="Default"></td>
                      {% endif %}
                      <td class="td_checkbox hide"></td>
                      <td class="td_username hide">{{user.first_name}}</td>
                      <td class="td_created_date hide date_column" id="current_date">
                          <p>
                          <script>
                            const date = new Date();
                            let currentDay = String(date.getDate()).padStart(2, '0');
                            let currentMonth = String(date.getMonth()+1).padStart(2,"0");
                            let currentYear = date.getFullYear();
                            let currentDate = `${currentYear}-${currentMonth}-${currentDay}`;

                            document.getElementById("current_date").innerHTML = currentDate;
                          </script>
                          </p>
                      </td>
                    </tr>
                  </tbody>
                </table>
            </div>
            </div>
    </div>
        <div class="container mt-2">
            <div class="row">
                <div class="col">
                    <button class="btn btn-success" type="submit" form="add_item">Add Item</button>
                </div>
                <div class="col d-flex align-items-end justify-content-end">
                    <form action="/delete_checked" method="POST" id="delete_items">
                        <button class="btn btn-danger" type="submit" form="delete_items">Delete checked</button>
                    </form>
                </div>
              </div>
        </div>
{% endblock %}